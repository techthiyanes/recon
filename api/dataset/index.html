
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Debug annotated Named Entity Recognition (NER) data for inconsitencies and get insights on improving the quality of your data." name="description"/>
<link href="https://kabirkhan.github.io/recon/api/dataset/" rel="canonical"/>
<link href="../../img/favicon.ico" rel="shortcut icon"/>
<meta content="mkdocs-1.1.2, mkdocs-material-5.5.1" name="generator"/>
<title>Dataset - Recon</title>
<link href="../../assets/stylesheets/main.5d00201e.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.816e8abc.min.css" rel="stylesheet"/>
<meta content="#2196f3" name="theme-color"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
<link href="../../css/termynal.css" rel="stylesheet"/>
<link href="../../css/custom.css" rel="stylesheet"/>
<meta content="https://kabirkhan.github.io/recon/api/dataset/" property="og:url"/>
<meta content="Dataset - Recon" property="og:title"/>
<meta content="Debug annotated Named Entity Recognition (NER) data for inconsitencies and get insights on improving the quality of your data." property="og:description"/>
<meta content="https://microsoft.github.io/reconner/img/recon.svg" property="og:image"/>
<meta content="Recon NER" property="og:image:alt"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="@kabir_khan14" name="twitter:site"/>
<meta content="@kabir_khan14" name="twitter:creator"/>
<meta content="Dataset - Recon" property="twitter:title"/>
<meta content="Debug annotated Named Entity Recognition (NER) data for inconsitencies and get insights on improving the quality of your data." name="twitter:description"/>
<meta content="https://microsoft.github.io/reconner/img/recon.svg" name="twitter:image"/>
<meta content="Recon NER" name="twitter:image:alt"/>
</head>
<body data-md-color-accent="blue" data-md-color-primary="blue" data-md-color-scheme="" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#recon.dataset">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header-nav md-grid">
<a aria-label="Recon" class="md-header-nav__button md-logo" href="https://kabirkhan.github.io/recon/" title="Recon">
<img alt="logo" src="../../img/drone-white.svg"/>
</a>
<label class="md-header-nav__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header-nav__title" data-md-component="header-title">
<div class="md-header-nav__ellipsis">
<span class="md-header-nav__topic md-ellipsis">
            Recon
          </span>
<span class="md-header-nav__topic md-ellipsis">
            
              Dataset
            
          </span>
</div>
</div>
<div class="md-header-nav__source">
<a class="md-source" href="https://github.com/kabirkhan/recon/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 480 512" xmlns="http://www.w3.org/2000/svg"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg>
</div>
<div class="md-source__repository">
    kabirkhan/recon
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Recon" class="md-nav__button md-logo" href="https://kabirkhan.github.io/recon/" title="Recon">
<img alt="logo" src="../../img/drone-white.svg"/>
</a>
    Recon
  </label>
<div class="md-nav__source">
<a class="md-source" href="https://github.com/kabirkhan/recon/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 480 512" xmlns="http://www.w3.org/2000/svg"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg>
</div>
<div class="md-source__repository">
    kabirkhan/recon
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../.." title="Recon">
      Recon
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" id="nav-2" type="checkbox"/>
<label class="md-nav__link" for="nav-2">
      Tutorial
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg>
</span>
</label>
<nav aria-label="Tutorial" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-2">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
        Tutorial
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorial/1_loading_data/" title="Loading your data">
      Loading your data
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorial/2_ner_stats/" title="NER Stats">
      NER Stats
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-3" id="nav-2-3" type="checkbox"/>
<label class="md-nav__link" for="nav-2-3">
      Dataset
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg>
</span>
</label>
<nav aria-label="Dataset" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="nav-2-3">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
        Dataset
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorial/3_dataset_intro/" title="Introduction">
      Introduction
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorial/3_dataset_mutate/" title="Making changes to a Dataset">
      Making changes to a Dataset
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorial/4_corpus/" title="Using a Corpus">
      Using a Corpus
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorial/4_more_stats/" title="More NER Stats">
      More NER Stats
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorial/5_getting_insights/" title="Getting Insights">
      Getting Insights
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorial/custom_entity_recognizer/" title="Custom EntityRecognizer">
      Custom EntityRecognizer
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="nav-3" id="nav-3" type="checkbox"/>
<label class="md-nav__link" for="nav-3">
      API Reference
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg>
</span>
</label>
<nav aria-label="API Reference" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-3">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
        API Reference
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../corpus/" title="Corpus">
      Corpus
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../corrections/" title="Corrections">
      Corrections
    </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
        Dataset
        <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"></path></svg>
</span>
</label>
<a class="md-nav__link md-nav__link--active" href="./" title="Dataset">
      Dataset
    </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#recon.dataset">
    recon.dataset
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recon.dataset.Dataset">
    Dataset
  </a>
<nav aria-label="Dataset" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#recon.dataset.Dataset.apply">
    apply()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recon.dataset.Dataset.apply_">
    apply_()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recon.dataset.Dataset.from_disk">
    from_disk()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recon.dataset.Dataset.from_prodigy">
    from_prodigy()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recon.dataset.Dataset.pipe_">
    pipe_()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recon.dataset.Dataset.to_disk">
    to_disk()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../hashing/" title="Hashing">
      Hashing
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../insights/" title="Insights">
      Insights
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../loaders/" title="Loaders">
      Loaders
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../operations/" title="Operations">
      Operations
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../stats/" title="Stats">
      Stats
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../store/" title="Store">
      Store
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tokenization/" title="Tokenization">
      Tokenization
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../validation/" title="Validation">
      Validation
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-12" id="nav-3-12" type="checkbox"/>
<label class="md-nav__link" for="nav-3-12">
      Recognizers
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg>
</span>
</label>
<nav aria-label="Recognizers" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="nav-3-12">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
        Recognizers
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../recognizers/base/" title="EntityRecognizer">
      EntityRecognizer
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../recognizers/spacy/" title="SpacyEntityRecognizer">
      SpacyEntityRecognizer
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../types/example/" title="Types">
      Types
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../release-notes/" title="Release Notes">
      Release Notes
    </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#recon.dataset">
    recon.dataset
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recon.dataset.Dataset">
    Dataset
  </a>
<nav aria-label="Dataset" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#recon.dataset.Dataset.apply">
    apply()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recon.dataset.Dataset.apply_">
    apply_()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recon.dataset.Dataset.from_disk">
    from_disk()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recon.dataset.Dataset.from_prodigy">
    from_prodigy()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recon.dataset.Dataset.pipe_">
    pipe_()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recon.dataset.Dataset.to_disk">
    to_disk()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/kabirkhan/recon/tree/master/docs/api/dataset.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1>Dataset</h1>
<div class="doc doc-object doc-module">
<h2 class="hidden-toc" href="#recon.dataset" id="recon.dataset" style="visibility: hidden; width: 0; height: 0;">
<a class="headerlink" href="#recon.dataset" title="Permanent link">¶</a></h2>
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="recon.dataset.Dataset">
<code>Dataset</code>
<a class="headerlink" href="#recon.dataset.Dataset" title="Permanent link">¶</a></h2>
<div class="doc doc-contents">
<p>A Dataset is a around a List of examples.
Datasets are responsible for tracking all Operations done on them.
This ensures data lineage and easy reporting of how changes in the
data based on various Operations effects overall quality.</p>
<p>Dataset holds state (let's call it self.operations for now)
self.operations is a list of every function run on the Dataset since it's
initial creation. If loading from disk, track everything that happens in loading
phase in operations as well by simply initializing self.operations in constructors</p>
<p>Each operation should has the following attributes:
    operation hash
    name: function/callable name ideally, could be added with a decorator
    status: (not_started|completed)
    !!! transformations "List[Transformation]"
        commit hash
        timestamp(s) - start and end both? end is probably enough
        examples deleted
        examples added
        examples corrected
        annotations deleted
        annotations added
        annotations corrected</p>
<div class="codehilite">
<pre><span></span><code><span class="err">    for annotations deleted/added/corrected, include mapping from old Example hash to new Example hash</span>
<span class="err">    that can be decoded for display later</span>
</code></pre>
</div>
<p>All operations are serializable in the to_disk and from_disk methods.</p>
<p>So if I have 10 possible transformations.</p>
<p>I can run 1..5, save to disk train a model and check results.
Then I can load that model from disk with all previous operations already tracked
in self.operations. Then I can run 6..10, save to disk and train model.
Now I have git-like "commits" for the data used in each model.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="recon.dataset.Dataset.apply">
<code class="highlight language-python">
apply<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#recon.dataset.Dataset.apply" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Apply a function to the dataset</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>func</code></td>
<td><code>Callable[[List[recon.types.Example], Any, Any], Any]</code></td>
<td>
<p>Function from an existing recon module that can operate on a List of examples</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Any</code></td>
<td>
<p>Result of running func on List of examples</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>recon/dataset.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>105
106
107
108
109
110
111
112
113
114
115
116
117</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">apply</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">List</span><span class="p">[</span><span class="n">Example</span><span class="p">],</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="sd">"""Apply a function to the dataset</span>

<span class="sd">    Args:</span>
<span class="sd">        func (Callable[[List[Example], Any, Any], Any]):</span>
<span class="sd">            Function from an existing recon module that can operate on a List of examples</span>

<span class="sd">    Returns:</span>
<span class="sd">        Result of running func on List of examples</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="recon.dataset.Dataset.apply_">
<code class="highlight language-python">
apply_<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#recon.dataset.Dataset.apply_" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Apply an operation to all data inplace.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>operation</code></td>
<td><code>Union[str, Callable[[Any], recon.types.OperationResult]]</code></td>
<td>
<p>Any operation that
changes data in place. See recon.operations.registry.operations</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>recon/dataset.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">apply_</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">operation</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">OperationResult</span><span class="p">]],</span>
    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">initial_state</span><span class="p">:</span> <span class="n">OperationState</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Apply an operation to all data inplace.</span>

<span class="sd">    Args:</span>
<span class="sd">        operation (Callable[[Any], OperationResult]): Any operation that</span>
<span class="sd">            changes data in place. See recon.operations.registry.operations</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">operation</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operation</span><span class="p">:</span>
            <span class="n">operation</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">,</span> <span class="n">operation</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"This function is not an operation since it does not have a name."</span><span class="p">)</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="n">Printer</span><span class="p">(</span><span class="n">no_print</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">"=&gt; Applying operation '</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">' inplace"</span><span class="p">)</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">OperationResult</span> <span class="o">=</span> <span class="n">operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">initial_state</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">good</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Completed operation '</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
    <span class="n">dataset_changed</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="n">result</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">examples_added</span><span class="p">,</span>
            <span class="n">result</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">examples_removed</span><span class="p">,</span>
            <span class="n">result</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">examples_changed</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">dataset_changed</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="recon.dataset.Dataset.from_disk">
<code class="highlight language-python">
from_disk<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">loader_func</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">read_jsonl</span> <span class="n">at</span> <span class="mh">0x7fb6d5a3aae8</span><span class="o">&gt;</span><span class="p">)</span> </code>
<a class="headerlink" href="#recon.dataset.Dataset.from_disk" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Load Dataset from disk given a path and a loader function that reads the data
and returns an iterator of Examples</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>path</code></td>
<td><code>Path</code></td>
<td>
<p>path to load from</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>loader_func</code></td>
<td><code>Callable</code></td>
<td>
<p>Callable that reads a file and returns a List of examples.
Defaults to <a href="https://kabirkhan.github.io/recon/api/loaders/#recon.loaders.read_jsonl">read_jsonl</a></p>
</td>
<td><code>&lt;function read_jsonl at 0x7fb6d5a3aae8&gt;</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>recon/dataset.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">from_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">loader_func</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">read_jsonl</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Dataset"</span><span class="p">:</span>
    <span class="sd">"""Load Dataset from disk given a path and a loader function that reads the data</span>
<span class="sd">    and returns an iterator of Examples</span>

<span class="sd">    Args:</span>
<span class="sd">        path (Path): path to load from</span>
<span class="sd">        loader_func (Callable, optional): Callable that reads a file and returns a List of examples.</span>
<span class="sd">            Defaults to [read_jsonl][recon.loaders.read_jsonl]</span>
<span class="sd">    """</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">ensure_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="s2">".recon"</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">srsly</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="s2">".recon"</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">/</span> <span class="s2">"state.json"</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">DatasetOperationsState</span><span class="p">(</span><span class="o">**</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operations</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">operations</span>

        <span class="n">example_store_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">/</span> <span class="s2">".recon"</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">/</span> <span class="s2">"example_store.jsonl"</span>
        <span class="k">if</span> <span class="n">example_store_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">example_store</span><span class="o">.</span><span class="n">from_disk</span><span class="p">(</span><span class="n">example_store_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">loader_func</span> <span class="o">==</span> <span class="n">read_json</span><span class="p">:</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="s2">".json"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="s2">".jsonl"</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">loader_func</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">example_store</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">state</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">commit_hash</span> <span class="o">!=</span> <span class="n">state</span><span class="o">.</span><span class="n">commit</span><span class="p">:</span>
        <span class="c1"># Dataset changed, examples added</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">OperationState</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">"recon.v1.examples_added_external"</span><span class="p">,</span>
                <span class="n">status</span><span class="o">=</span><span class="n">OperationStatus</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">,</span>
                <span class="n">ts</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
                <span class="n">examples_added</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="n">state</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">examples_removed</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">examples_changed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">transformations</span><span class="o">=</span><span class="p">[],</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">operations</span><span class="p">:</span>
            <span class="n">op</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">OperationStatus</span><span class="o">.</span><span class="n">NOT_STARTED</span>

    <span class="n">seen</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">operations_to_run</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">OperationState</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">operations</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">op</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">operations_to_run</span>
            <span class="ow">and</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">registry</span><span class="o">.</span><span class="n">operations</span>
            <span class="ow">and</span> <span class="n">op</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="n">OperationStatus</span><span class="o">.</span><span class="n">COMPLETED</span>
        <span class="p">):</span>
            <span class="n">operations_to_run</span><span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">op</span>

    <span class="k">for</span> <span class="n">op_name</span><span class="p">,</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">operations_to_run</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">op_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="o">*</span><span class="n">state</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> <span class="o">**</span><span class="n">state</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="recon.dataset.Dataset.from_prodigy">
<code class="highlight language-python">
from_prodigy<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prodigy_datasets</span><span class="p">)</span> </code>
<a class="headerlink" href="#recon.dataset.Dataset.from_prodigy" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Need to have from_prodigy accept multiple datasets as a list of str so Prodigy
can stay separate and new annotation sessions can happen often. Basically prodigy db-merge</p>
<p>Need to save to only 1 prodigy dataset though for consistency</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>prodigy_datasets</code></td>
<td><code>List[str]</code></td>
<td>
<p>List of prodigy datasets to load from</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Dataset</code></td>
<td>
<p>Dataset: Initialized dataset with Prodigy data</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>recon/dataset.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">from_prodigy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prodigy_datasets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">"Dataset"</span><span class="p">:</span>
    <span class="sd">"""Need to have from_prodigy accept multiple datasets as a list of str so Prodigy</span>
<span class="sd">    can stay separate and new annotation sessions can happen often. Basically prodigy db-merge</span>

<span class="sd">    Need to save to only 1 prodigy dataset though for consistency</span>

<span class="sd">    Args:</span>
<span class="sd">        prodigy_datasets (List[str]): List of prodigy datasets to load from</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dataset: Initialized dataset with Prodigy data</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">recon.prodigy.util</span> <span class="kn">import</span> <span class="n">from_prodigy</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Loading data from prodigy datasets: </span><span class="si">{</span><span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prodigy_datasets</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">prodigy_dataset</span> <span class="ow">in</span> <span class="n">prodigy_datasets</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">+=</span> <span class="n">from_prodigy</span><span class="p">(</span><span class="n">prodigy_dataset</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="recon.dataset.Dataset.pipe_">
<code class="highlight language-python">
pipe_<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operations</span><span class="p">)</span> </code>
<a class="headerlink" href="#recon.dataset.Dataset.pipe_" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Run a sequence of operations on dataset data.
Internally calls Dataset.apply_ and will resolve named
operations in registry.operations</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>operations</code></td>
<td><code>List[Union[str, recon.types.OperationState]]</code></td>
<td>
<p>List of operations</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>recon/dataset.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">pipe_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">OperationState</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Run a sequence of operations on dataset data.</span>
<span class="sd">    Internally calls Dataset.apply_ and will resolve named</span>
<span class="sd">    operations in registry.operations</span>

<span class="sd">    Args:</span>
<span class="sd">        operations (List[Union[str, OperationState]]): List of operations</span>
<span class="sd">    """</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="n">Printer</span><span class="p">(</span><span class="n">no_print</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Applying pipeline of operations inplace to the dataset: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">operations</span><span class="p">:</span>
        <span class="n">op_name</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">OperationState</span><span class="p">)</span> <span class="k">else</span> <span class="n">op</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">"|_ </span><span class="si">{</span><span class="n">op_name</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">operations</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">op_name</span> <span class="o">=</span> <span class="n">op</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">initial_state</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">OperationState</span><span class="p">):</span>
            <span class="n">op_name</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">args</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">kwargs</span>
            <span class="n">initial_state</span> <span class="o">=</span> <span class="n">op</span>

        <span class="n">operation</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">op_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apply_</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">initial_state</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="recon.dataset.Dataset.to_disk">
<code class="highlight language-python">
to_disk<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_examples</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </code>
<a class="headerlink" href="#recon.dataset.Dataset.to_disk" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Save Corpus to Disk</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>output_dir</code></td>
<td><code>Path</code></td>
<td>
<p>Output file path to save data to</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>force</code></td>
<td><code>bool</code></td>
<td>
<p>Force save to directory. Create parent directories
or overwrite existing data.</p>
</td>
<td><code>False</code></td>
</tr>
<tr>
<td><code>save_examples</code></td>
<td><code>bool</code></td>
<td>
<p>Save the example store along with the state.</p>
</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>recon/dataset.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">to_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">save_examples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Save Corpus to Disk</span>

<span class="sd">    Args:</span>
<span class="sd">        output_dir (Path): Output file path to save data to</span>
<span class="sd">        force (bool): Force save to directory. Create parent directories</span>
<span class="sd">            or overwrite existing data.</span>
<span class="sd">        save_examples (bool): Save the example store along with the state.</span>
<span class="sd">    """</span>
    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">ensure_path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
    <span class="n">state_dir</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s2">".recon"</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
        <span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">state_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">state_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">DatasetOperationsState</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commit_hash</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">operations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">operations</span>
    <span class="p">)</span>
    <span class="n">srsly</span><span class="o">.</span><span class="n">write_json</span><span class="p">(</span><span class="n">state_dir</span> <span class="o">/</span> <span class="s2">"state.json"</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">save_examples</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">example_store</span><span class="o">.</span><span class="n">to_disk</span><span class="p">(</span><span class="n">state_dir</span> <span class="o">/</span> <span class="s2">"example_store.jsonl"</span><span class="p">)</span>

    <span class="n">srsly</span><span class="o">.</span><span class="n">write_jsonl</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">".jsonl"</span><span class="p">),</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav aria-label="Footer" class="md-footer-nav__inner md-grid">
<a class="md-footer-nav__link md-footer-nav__link--prev" href="../corrections/" rel="prev" title="Corrections">
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Previous
                </span>
                Corrections
              </div>
</div>
</a>
<a class="md-footer-nav__link md-footer-nav__link--next" href="../hashing/" rel="next" title="Hashing">
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Next
                </span>
                Hashing
              </div>
</div>
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
<div class="md-footer-social">
<a class="md-footer-social__link" href="https://github.com/kabirkhan/recon" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 480 512" xmlns="http://www.w3.org/2000/svg"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://twitter.com/kabir_khan14" rel="noopener" target="_blank" title="twitter.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<script src="../../assets/javascripts/vendor.592d4e23.min.js"></script>
<script src="../../assets/javascripts/bundle.073197b2.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
<script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.01088dc6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
<script src="../../js/termynal.js"></script>
<script src="https://unpkg.com/mermaid@8.4.6/dist/mermaid.min.js"></script>
<script src="../../js/custom.js"></script>
</body>
</html>