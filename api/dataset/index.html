



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Debug annotated Named Entity Recognition (NER) data for inconsitencies and get insights on improving the quality of your data.">
      
      
        <link rel="canonical" href="https://kabirkhan.github.io/recon/api/dataset/">
      
      
      <link rel="shortcut icon" href="../../img/recon.svg">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-5.5.14">
    
    
      
        <title>Dataset - Recon</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.d3202873.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ff0a5ce4.min.css">
      
      
        
        
        <meta name="theme-color" content="#ffffff">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/termynal.css">
    
      <link rel="stylesheet" href="../../css/custom.css">
    
    
      
    
    

  <meta property="og:url" content="https://kabirkhan.github.io/recon/api/dataset/">
  
    <meta property="og:title" content="Dataset - Recon">
  
  <meta property="og:description" content="Debug annotated Named Entity Recognition (NER) data for inconsitencies and get insights on improving the quality of your data.">
  <meta property="og:image" content="https://microsoft.github.io/reconner/img/recon.svg">
  <meta property="og:image:alt" content="Recon NER">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@kabir_khan14">
  <meta name="twitter:creator" content="@kabir_khan14">
  
    <meta property="twitter:title" content="Dataset - Recon">
  
  <meta name="twitter:description" content="Debug annotated Named Entity Recognition (NER) data for inconsitencies and get insights on improving the quality of your data.">
  <meta name="twitter:image" content="https://microsoft.github.io/reconner/img/recon.svg">
  <meta name="twitter:image:alt" content="Recon NER">


  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#recon.dataset" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://kabirkhan.github.io/recon/" title="Recon" class="md-header-nav__button md-logo" aria-label="Recon">
      
  <img src="../../img/recon.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Recon
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Dataset
            
          </span>
        </div>
      
    </div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/kabirkhan/recon" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    kabirkhan/recon
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://kabirkhan.github.io/recon/" title="Recon" class="md-nav__button md-logo" aria-label="Recon">
      
  <img src="../../img/recon.svg" alt="logo">

    </a>
    Recon
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/kabirkhan/recon" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    kabirkhan/recon
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Recon" class="md-nav__link">
      Recon
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Tutorial
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Tutorial" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorial/1_loading_data/" title="Loading your data" class="md-nav__link">
      Loading your data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorial/2_ner_stats/" title="NER Stats" class="md-nav__link">
      NER Stats
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Dataset
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Dataset" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        <span class="md-nav__icon md-icon"></span>
        Dataset
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorial/3_dataset_intro/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorial/3_dataset_mutate/" title="Making changes to a Dataset" class="md-nav__link">
      Making changes to a Dataset
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorial/4_corpus/" title="Using a Corpus" class="md-nav__link">
      Using a Corpus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorial/4_more_stats/" title="More NER Stats" class="md-nav__link">
      More NER Stats
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorial/5_getting_insights/" title="Getting Insights" class="md-nav__link">
      Getting Insights
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorial/custom_entity_recognizer/" title="Custom EntityRecognizer" class="md-nav__link">
      Custom EntityRecognizer
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      API Reference
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="API Reference" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        API Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../corpus/" title="Corpus" class="md-nav__link">
      Corpus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../corrections/" title="Corrections" class="md-nav__link">
      Corrections
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Dataset
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="Dataset" class="md-nav__link md-nav__link--active">
      Dataset
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#recon.dataset" class="md-nav__link">
    recon.dataset
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recon.dataset.Dataset" class="md-nav__link">
    Dataset
  </a>
  
    <nav class="md-nav" aria-label="Dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.commit_hash" class="md-nav__link">
    commit_hash
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.apply" class="md-nav__link">
    apply()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.apply_" class="md-nav__link">
    apply_()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.from_disk" class="md-nav__link">
    from_disk()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.from_prodigy" class="md-nav__link">
    from_prodigy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.from_spacy" class="md-nav__link">
    from_spacy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.pipe_" class="md-nav__link">
    pipe_()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.rollback" class="md-nav__link">
    rollback()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.search" class="md-nav__link">
    search()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.set_example_store" class="md-nav__link">
    set_example_store()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.to_disk" class="md-nav__link">
    to_disk()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.to_prodigy" class="md-nav__link">
    to_prodigy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.to_spacy" class="md-nav__link">
    to_spacy()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hashing/" title="Hashing" class="md-nav__link">
      Hashing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../insights/" title="Insights" class="md-nav__link">
      Insights
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../loaders/" title="Loaders" class="md-nav__link">
      Loaders
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../operations/" title="Operations" class="md-nav__link">
      Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../stats/" title="Stats" class="md-nav__link">
      Stats
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../store/" title="Store" class="md-nav__link">
      Store
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tokenization/" title="Tokenization" class="md-nav__link">
      Tokenization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../validation/" title="Validation" class="md-nav__link">
      Validation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-12" type="checkbox" id="nav-3-12">
    
    <label class="md-nav__link" for="nav-3-12">
      Recognizers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Recognizers" data-md-level="2">
      <label class="md-nav__title" for="nav-3-12">
        <span class="md-nav__icon md-icon"></span>
        Recognizers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../recognizers/base/" title="EntityRecognizer" class="md-nav__link">
      EntityRecognizer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../recognizers/spacy/" title="SpacyEntityRecognizer" class="md-nav__link">
      SpacyEntityRecognizer
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../types/example/" title="Types" class="md-nav__link">
      Types
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#recon.dataset" class="md-nav__link">
    recon.dataset
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recon.dataset.Dataset" class="md-nav__link">
    Dataset
  </a>
  
    <nav class="md-nav" aria-label="Dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.commit_hash" class="md-nav__link">
    commit_hash
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.apply" class="md-nav__link">
    apply()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.apply_" class="md-nav__link">
    apply_()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.from_disk" class="md-nav__link">
    from_disk()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.from_prodigy" class="md-nav__link">
    from_prodigy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.from_spacy" class="md-nav__link">
    from_spacy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.pipe_" class="md-nav__link">
    pipe_()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.rollback" class="md-nav__link">
    rollback()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.search" class="md-nav__link">
    search()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.set_example_store" class="md-nav__link">
    set_example_store()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.to_disk" class="md-nav__link">
    to_disk()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.to_prodigy" class="md-nav__link">
    to_prodigy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recon.dataset.Dataset.to_spacy" class="md-nav__link">
    to_spacy()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/kabirkhan/recon/tree/master/docs/api/dataset.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                  <h1>Dataset</h1>
                
                <div class="doc doc-object doc-module">

<a id="recon.dataset"></a>
    <div class="doc doc-contents first">




  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h2 id="recon.dataset.Dataset" class="doc doc-heading">
        <code>
Dataset        </code>



<a href="#recon.dataset.Dataset" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>A Dataset is a around a List of examples.
Datasets are responsible for tracking all Operations done on them.
This ensures data lineage and easy reporting of how changes in the
data based on various Operations effects overall quality.</p>
<p>Dataset holds state (let's call it self.operations for now)
self.operations is a list of every function run on the Dataset since it's
initial creation. If loading from disk, track everything that happens in loading
phase in operations as well by simply initializing self.operations in constructors</p>
<p>Each operation should has the following attributes:
    operation hash
    name: function/callable name ideally, could be added with a decorator
    status: (not_started|completed)
    !!! transformations "List[Transformation]"
        commit hash
        timestamp(s) - start and end both? end is probably enough
        examples deleted
        examples added
        examples corrected
        annotations deleted
        annotations added
        annotations corrected</p>
<div class="codehilite"><pre><span></span><code>    <span class="k">for</span> <span class="nv">annotations</span> <span class="nv">deleted</span><span class="o">/</span><span class="nv">added</span><span class="o">/</span><span class="nv">corrected</span>, <span class="k">include</span> <span class="nv">mapping</span> <span class="nv">from</span> <span class="nv">old</span> <span class="nv">Example</span> <span class="nv">hash</span> <span class="nv">to</span> <span class="nv">new</span> <span class="nv">Example</span> <span class="nv">hash</span>
    <span class="nv">that</span> <span class="nv">can</span> <span class="nv">be</span> <span class="nv">decoded</span> <span class="k">for</span> <span class="nv">display</span> <span class="nv">later</span>
</code></pre></div>

<p>All operations are serializable in the to_disk and from_disk methods.</p>
<p>So if I have 10 possible transformations.</p>
<p>I can run 1..5, save to disk train a model and check results.
Then I can load that model from disk with all previous operations already tracked
in self.operations. Then I can run 6..10, save to disk and train model.
Now I have git-like "commits" for the data used in each model.</p>

        <details class="quote">
          <summary>Source code in <code>recon/dataset.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Dataset</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A Dataset is a around a List of examples.</span>
<span class="sd">    Datasets are responsible for tracking all Operations done on them.</span>
<span class="sd">    This ensures data lineage and easy reporting of how changes in the</span>
<span class="sd">    data based on various Operations effects overall quality.</span>

<span class="sd">    Dataset holds state (let&#39;s call it self.operations for now)</span>
<span class="sd">    self.operations is a list of every function run on the Dataset since it&#39;s</span>
<span class="sd">    initial creation. If loading from disk, track everything that happens in loading</span>
<span class="sd">    phase in operations as well by simply initializing self.operations in constructors</span>

<span class="sd">    Each operation should has the following attributes:</span>
<span class="sd">        operation hash</span>
<span class="sd">        name: function/callable name ideally, could be added with a decorator</span>
<span class="sd">        status: (not_started|completed)</span>
<span class="sd">        transformations: List[Transformation]</span>
<span class="sd">            commit hash</span>
<span class="sd">            timestamp(s) - start and end both? end is probably enough</span>
<span class="sd">            examples deleted</span>
<span class="sd">            examples added</span>
<span class="sd">            examples corrected</span>
<span class="sd">            annotations deleted</span>
<span class="sd">            annotations added</span>
<span class="sd">            annotations corrected</span>

<span class="sd">            for annotations deleted/added/corrected, include mapping from old Example hash to new Example hash</span>
<span class="sd">            that can be decoded for display later</span>

<span class="sd">    All operations are serializable in the to_disk and from_disk methods.</span>

<span class="sd">    So if I have 10 possible transformations.</span>

<span class="sd">    I can run 1..5, save to disk train a model and check results.</span>
<span class="sd">    Then I can load that model from disk with all previous operations already tracked</span>
<span class="sd">    in self.operations. Then I can run 6..10, save to disk and train model.</span>
<span class="sd">    Now I have git-like &quot;commits&quot; for the data used in each model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Example</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">operations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">OperationState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">example_store</span><span class="p">:</span> <span class="n">ExampleStore</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">operations</span><span class="p">:</span>
            <span class="n">operations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="n">operations</span>

        <span class="k">if</span> <span class="n">example_store</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">example_store</span> <span class="o">=</span> <span class="n">ExampleStore</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_example_store</span> <span class="o">=</span> <span class="n">example_store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NERStats</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">commit_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;String representation of internal hash</span>
<span class="sd">        that can be used to mark a checkpoint in a dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">dataset_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_int</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Example</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">operations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">OperationState</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">example_store</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExampleStore</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_example_store</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NERStats</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span> <span class="o">=</span> <span class="n">get_ner_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span>

    <span class="k">def</span> <span class="nf">print_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">get_ner_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">serialize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Dataset: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="sa">f</span><span class="s2">&quot;Stats: </span><span class="si">{</span><span class="n">stats</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">dataset_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">example_hash</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Example</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hash</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">==</span> <span class="n">example_hash</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">e</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Example with hash </span><span class="si">{</span><span class="n">example_hash</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">List</span><span class="p">[</span><span class="n">Example</span><span class="p">],</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Apply a function to the dataset</span>

<span class="sd">        Args:</span>
<span class="sd">            func (Callable[[List[Example], Any, Any], Any]):</span>
<span class="sd">                Function from an existing recon module that can operate on a List of examples</span>

<span class="sd">        Returns:</span>
<span class="sd">            Result of running func on List of examples</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">def</span> <span class="nf">apply_</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">operation</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">OperationResult</span><span class="p">]],</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">OperationState</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Apply an operation to all data inplace.</span>

<span class="sd">        Args:</span>
<span class="sd">            operation (Callable[[Any], OperationResult]): Any operation that</span>
<span class="sd">                changes data in place. See recon.operations.registry.operations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">operation</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">operation</span><span class="p">:</span>
                <span class="n">operation</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">,</span> <span class="n">operation</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This function is not an operation since it does not have a name.&quot;</span><span class="p">)</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="n">Printer</span><span class="p">(</span><span class="n">no_print</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verbose</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=&gt; Applying operation &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; to dataset &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">OperationResult</span> <span class="o">=</span> <span class="n">operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">initial_state</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verbose</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">good</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Completed operation &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
        <span class="n">dataset_changed</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">result</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">examples_added</span><span class="p">,</span>
                <span class="n">result</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">examples_removed</span><span class="p">,</span>
                <span class="n">result</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">examples_changed</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">dataset_changed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">pipe_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">OperationState</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Run a sequence of operations on dataset data.</span>
<span class="sd">        Internally calls Dataset.apply_ and will resolve named</span>
<span class="sd">        operations in registry.operations</span>

<span class="sd">        Args:</span>
<span class="sd">            operations (List[Union[str, OperationState]]): List of operations</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="n">Printer</span><span class="p">(</span><span class="n">no_print</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verbose</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Applying pipeline of operations inplace to the dataset: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">operations</span><span class="p">:</span>
            <span class="n">op_name</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">OperationState</span><span class="p">)</span> <span class="k">else</span> <span class="n">op</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;|_ </span><span class="si">{</span><span class="n">op_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">operations</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">op_name</span> <span class="o">=</span> <span class="n">op</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">initial_state</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">OperationState</span><span class="p">):</span>
                <span class="n">op_name</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">args</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">kwargs</span>
                <span class="n">initial_state</span> <span class="o">=</span> <span class="n">op</span>

            <span class="n">operation</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">op_name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">apply_</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">initial_state</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rollback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Rollback the last n operations on a dataset.</span>

<span class="sd">        e.g.</span>
<span class="sd">            ```</span>
<span class="sd">            ds = Dataset(&quot;name&quot;, data)</span>

<span class="sd">            initial_ds_hash = hash(ds)</span>

<span class="sd">            ds.apply_(&quot;some_operation&quot;)</span>
<span class="sd">            ds.rollback()</span>

<span class="sd">            hash(ds) == initial_ds_hash</span>
<span class="sd">            &gt;&gt;&gt; True # This should be True</span>

<span class="sd">        Args:</span>
<span class="sd">            n (int): Number of operations to rollback</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot rollback dataset: n must be 1 or higher.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operations</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot rollback dataset: n is larger than the total number of dataset operations.&quot;</span><span class="p">)</span>

        <span class="n">store</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">example_store</span>

        <span class="n">examples_to_remove</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">examples_to_add</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">operations</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:]:</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">op</span><span class="o">.</span><span class="n">transformations</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">TransformationType</span><span class="o">.</span><span class="n">EXAMPLE_ADDED</span><span class="p">:</span>
                    <span class="n">examples_to_remove</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">example</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">TransformationType</span><span class="o">.</span><span class="n">EXAMPLE_CHANGED</span><span class="p">:</span>
                    <span class="n">examples_to_remove</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">example</span><span class="p">)</span>
                    <span class="n">examples_to_add</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">store</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">prev_example</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
                <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">TransformationType</span><span class="o">.</span><span class="n">EXAMPLE_REMOVED</span><span class="p">:</span>
                    <span class="n">examples_to_add</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">store</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">prev_example</span><span class="p">])</span>  <span class="c1"># type: ignore</span>

        <span class="n">old_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="nb">hash</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">examples_to_remove</span><span class="p">]</span>
        <span class="n">old_data</span> <span class="o">+=</span> <span class="n">examples_to_add</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">old_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operations</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">examples_to_remove</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_example_store</span><span class="o">.</span><span class="n">_map</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>  <span class="c1"># type: ignore</span>

    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Example</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Naive search method to quickly identify examples matching the provided substring</span>

<span class="sd">        Args:</span>
<span class="sd">            search_query (str): Substring to search each example for</span>
<span class="sd">            case_sensitive (bool, optional): Consider case of search query and example text</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[Example]: Matched examples</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">search_query</span> <span class="o">=</span> <span class="n">search_query</span> <span class="k">if</span> <span class="n">case_sensitive</span> <span class="k">else</span> <span class="n">search_query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">out_examples</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">example_text</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">case_sensitive</span> <span class="k">else</span> <span class="n">example</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">search_query</span> <span class="ow">in</span> <span class="n">example_text</span><span class="p">:</span>
                <span class="n">out_examples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out_examples</span>

    <span class="k">def</span> <span class="nf">set_example_store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">example_store</span><span class="p">:</span> <span class="n">ExampleStore</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Overwrite the the internal ExampleStore. You probably don&#39;t want to call this.</span>
<span class="sd">        Used by the Corpus to ensure the ExampleStore of each dataset is complete.</span>

<span class="sd">        Args:</span>
<span class="sd">            example_store (ExampleStore): ExampleStore to overwrite with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_example_store</span> <span class="o">=</span> <span class="n">example_store</span>

    <span class="k">def</span> <span class="nf">from_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">loader_func</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">read_jsonl</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load Dataset from disk given a path and a loader function that reads the data</span>
<span class="sd">        and returns an iterator of Examples</span>

<span class="sd">        Args:</span>
<span class="sd">            path (Path): path to load from</span>
<span class="sd">            loader_func (Callable, optional): Callable that reads a file and returns a List of examples.</span>
<span class="sd">                Defaults to [read_jsonl][recon.loaders.read_jsonl]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">ensure_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="s2">&quot;.recon&quot;</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">srsly</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="s2">&quot;.recon&quot;</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">/</span> <span class="s2">&quot;state.json&quot;</span><span class="p">)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">DatasetOperationsState</span><span class="p">(</span><span class="o">**</span><span class="n">state</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">operations</span>

            <span class="n">example_store_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">/</span> <span class="s2">&quot;.recon&quot;</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">/</span> <span class="s2">&quot;example_store.jsonl&quot;</span>
            <span class="k">if</span> <span class="n">example_store_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_example_store</span><span class="o">.</span><span class="n">from_disk</span><span class="p">(</span><span class="n">example_store_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">loader_func</span> <span class="o">==</span> <span class="n">read_json</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;.json&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;.jsonl&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">loader_func</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>

        <span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_example_store</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">state</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">commit_hash</span> <span class="o">!=</span> <span class="n">state</span><span class="o">.</span><span class="n">commit</span><span class="p">:</span>
            <span class="c1"># Dataset changed, examples added</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">OperationState</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;recon.v1.examples_added_external&quot;</span><span class="p">,</span>
                    <span class="n">status</span><span class="o">=</span><span class="n">OperationStatus</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">,</span>
                    <span class="n">ts</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
                    <span class="n">examples_added</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="n">state</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">examples_removed</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">examples_changed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">transformations</span><span class="o">=</span><span class="p">[],</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">:</span>
                <span class="n">op</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">OperationStatus</span><span class="o">.</span><span class="n">NOT_STARTED</span>

        <span class="n">seen</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">operations_to_run</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">OperationState</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">op</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">operations_to_run</span>
                <span class="ow">and</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">registry</span><span class="o">.</span><span class="n">operations</span>
                <span class="ow">and</span> <span class="n">op</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="n">OperationStatus</span><span class="o">.</span><span class="n">COMPLETED</span>
            <span class="p">):</span>
                <span class="n">operations_to_run</span><span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">op</span>

        <span class="k">for</span> <span class="n">op_name</span><span class="p">,</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">operations_to_run</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">op_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="o">*</span><span class="n">state</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> <span class="o">**</span><span class="n">state</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">to_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">save_examples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Save Corpus to Disk</span>

<span class="sd">        Args:</span>
<span class="sd">            output_dir (Path): Output file path to save data to</span>
<span class="sd">            overwrite (bool): Force save to directory. Create parent directories</span>
<span class="sd">                or overwrite existing data.</span>
<span class="sd">            save_examples (bool): Save the example store along with the state.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">ensure_path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
        <span class="n">state_dir</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;.recon&quot;</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">output_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Output directory is not empty. Set overwrite=True in Dataset.to_disk to clear the directory before saving.&quot;</span>
            <span class="p">)</span>

        <span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">state_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">state_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">state</span> <span class="o">=</span> <span class="n">DatasetOperationsState</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commit_hash</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">operations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">operations</span>
        <span class="p">)</span>
        <span class="n">srsly</span><span class="o">.</span><span class="n">write_json</span><span class="p">(</span><span class="n">state_dir</span> <span class="o">/</span> <span class="s2">&quot;state.json&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">save_examples</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">example_store</span><span class="o">.</span><span class="n">to_disk</span><span class="p">(</span><span class="n">state_dir</span> <span class="o">/</span> <span class="s2">&quot;example_store.jsonl&quot;</span><span class="p">)</span>

        <span class="n">srsly</span><span class="o">.</span><span class="n">write_jsonl</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.jsonl&quot;</span><span class="p">),</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">from_prodigy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prodigy_datasets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Need to have from_prodigy accept multiple datasets as a list of str so Prodigy</span>
<span class="sd">        can stay separate and new annotation sessions can happen often. Basically prodigy db-merge</span>

<span class="sd">        Need to save to only 1 prodigy dataset though for consistency</span>

<span class="sd">        Args:</span>
<span class="sd">            prodigy_datasets (List[str]): List of prodigy datasets to load from</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dataset: Initialized dataset with Prodigy data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">recon.prodigy.utils</span> <span class="kn">import</span> <span class="n">from_prodigy</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading data from prodigy datasets: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prodigy_datasets</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">prodigy_dataset</span> <span class="ow">in</span> <span class="n">prodigy_datasets</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">+=</span> <span class="n">from_prodigy</span><span class="p">(</span><span class="n">prodigy_dataset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">to_prodigy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prodigy_dataset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Save examples to prodigy dataset</span>

<span class="sd">        Args:</span>
<span class="sd">            prodigy_dataset (str, optional): Prodigy dataset name to save to.</span>
<span class="sd">            overwrite (bool, optional): Overwrite dataset name if it exists.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Prodigy dataset name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">recon.prodigy.utils</span> <span class="kn">import</span> <span class="n">to_prodigy</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">prodigy_dataset</span><span class="p">:</span>
            <span class="n">prodigy_dataset</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">commit_hash</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving dataset to prodigy dataset: </span><span class="si">{</span><span class="n">prodigy_dataset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">to_prodigy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">prodigy_dataset</span><span class="p">,</span> <span class="n">overwrite_dataset</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prodigy_dataset</span>

    <span class="k">def</span> <span class="nf">from_spacy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load Dataset from a file in the .spacy format</span>

<span class="sd">        Args:</span>
<span class="sd">            path (Path): path to load from</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dataset: Initialized dataset with Prodigy data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">from_spacy</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">to_spacy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Save data to .spacy file</span>

<span class="sd">        Saves file as {output_dir}/{self.name}.spacy</span>

<span class="sd">        Args:</span>
<span class="sd">            output_dir (Path): Output file path to save data to</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">ensure_path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
        <span class="n">to_spacy</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.spacy&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h3 id="recon.dataset.Dataset.commit_hash" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">commit_hash</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#recon.dataset.Dataset.commit_hash" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>String representation of internal hash
that can be used to mark a checkpoint in a dataset.</p>
    </div>

  </div>















  <div class="doc doc-object doc-method">



<h3 id="recon.dataset.Dataset.apply" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#recon.dataset.Dataset.apply" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Apply a function to the dataset</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>func</code></td>
        <td><code>Callable[[List[Example], Any, Any], Any]</code></td>
        <td><p>Function from an existing recon module that can operate on a List of examples</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Any</code></td>
      <td><p>Result of running func on List of examples</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>recon/dataset.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">List</span><span class="p">[</span><span class="n">Example</span><span class="p">],</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Apply a function to the dataset</span>

<span class="sd">    Args:</span>
<span class="sd">        func (Callable[[List[Example], Any, Any], Any]):</span>
<span class="sd">            Function from an existing recon module that can operate on a List of examples</span>

<span class="sd">    Returns:</span>
<span class="sd">        Result of running func on List of examples</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="recon.dataset.Dataset.apply_" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">apply_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#recon.dataset.Dataset.apply_" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Apply an operation to all data inplace.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>operation</code></td>
        <td><code>Callable[[Any], OperationResult]</code></td>
        <td><p>Any operation that
changes data in place. See recon.operations.registry.operations</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>recon/dataset.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">apply_</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">operation</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">OperationResult</span><span class="p">]],</span>
    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">initial_state</span><span class="p">:</span> <span class="n">OperationState</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Apply an operation to all data inplace.</span>

<span class="sd">    Args:</span>
<span class="sd">        operation (Callable[[Any], OperationResult]): Any operation that</span>
<span class="sd">            changes data in place. See recon.operations.registry.operations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">operation</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operation</span><span class="p">:</span>
            <span class="n">operation</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">,</span> <span class="n">operation</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This function is not an operation since it does not have a name.&quot;</span><span class="p">)</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="n">Printer</span><span class="p">(</span><span class="n">no_print</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verbose</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=&gt; Applying operation &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; to dataset &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">OperationResult</span> <span class="o">=</span> <span class="n">operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">initial_state</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verbose</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">good</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Completed operation &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
    <span class="n">dataset_changed</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="n">result</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">examples_added</span><span class="p">,</span>
            <span class="n">result</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">examples_removed</span><span class="p">,</span>
            <span class="n">result</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">examples_changed</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">dataset_changed</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="recon.dataset.Dataset.from_disk" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">from_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">loader_func</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">read_jsonl</span> <span class="n">at</span> <span class="mh">0x121529630</span><span class="o">&gt;</span><span class="p">)</span></code>


<a href="#recon.dataset.Dataset.from_disk" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Load Dataset from disk given a path and a loader function that reads the data
and returns an iterator of Examples</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>Path</code></td>
        <td><p>path to load from</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>loader_func</code></td>
        <td><code>Callable</code></td>
        <td><p>Callable that reads a file and returns a List of examples.
Defaults to <a class="autorefs autorefs-internal" href="../loaders/#recon.loaders.read_jsonl">read_jsonl</a></p></td>
        <td><code>&lt;function read_jsonl at 0x121529630&gt;</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>recon/dataset.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">from_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">loader_func</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">read_jsonl</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Load Dataset from disk given a path and a loader function that reads the data</span>
<span class="sd">    and returns an iterator of Examples</span>

<span class="sd">    Args:</span>
<span class="sd">        path (Path): path to load from</span>
<span class="sd">        loader_func (Callable, optional): Callable that reads a file and returns a List of examples.</span>
<span class="sd">            Defaults to [read_jsonl][recon.loaders.read_jsonl]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">ensure_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="s2">&quot;.recon&quot;</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">srsly</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="s2">&quot;.recon&quot;</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">/</span> <span class="s2">&quot;state.json&quot;</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">DatasetOperationsState</span><span class="p">(</span><span class="o">**</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">operations</span>

        <span class="n">example_store_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">/</span> <span class="s2">&quot;.recon&quot;</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">/</span> <span class="s2">&quot;example_store.jsonl&quot;</span>
        <span class="k">if</span> <span class="n">example_store_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_example_store</span><span class="o">.</span><span class="n">from_disk</span><span class="p">(</span><span class="n">example_store_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">loader_func</span> <span class="o">==</span> <span class="n">read_json</span><span class="p">:</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;.json&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;.jsonl&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">loader_func</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_example_store</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">state</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">commit_hash</span> <span class="o">!=</span> <span class="n">state</span><span class="o">.</span><span class="n">commit</span><span class="p">:</span>
        <span class="c1"># Dataset changed, examples added</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">OperationState</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;recon.v1.examples_added_external&quot;</span><span class="p">,</span>
                <span class="n">status</span><span class="o">=</span><span class="n">OperationStatus</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">,</span>
                <span class="n">ts</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
                <span class="n">examples_added</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="n">state</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">examples_removed</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">examples_changed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">transformations</span><span class="o">=</span><span class="p">[],</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">:</span>
            <span class="n">op</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">OperationStatus</span><span class="o">.</span><span class="n">NOT_STARTED</span>

    <span class="n">seen</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">operations_to_run</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">OperationState</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">op</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">operations_to_run</span>
            <span class="ow">and</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">registry</span><span class="o">.</span><span class="n">operations</span>
            <span class="ow">and</span> <span class="n">op</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="n">OperationStatus</span><span class="o">.</span><span class="n">COMPLETED</span>
        <span class="p">):</span>
            <span class="n">operations_to_run</span><span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">op</span>

    <span class="k">for</span> <span class="n">op_name</span><span class="p">,</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">operations_to_run</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">op_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="o">*</span><span class="n">state</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> <span class="o">**</span><span class="n">state</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="recon.dataset.Dataset.from_prodigy" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">from_prodigy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prodigy_datasets</span><span class="p">)</span></code>


<a href="#recon.dataset.Dataset.from_prodigy" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Need to have from_prodigy accept multiple datasets as a list of str so Prodigy
can stay separate and new annotation sessions can happen often. Basically prodigy db-merge</p>
<p>Need to save to only 1 prodigy dataset though for consistency</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>prodigy_datasets</code></td>
        <td><code>List[str]</code></td>
        <td><p>List of prodigy datasets to load from</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dataset</code></td>
      <td><p>Initialized dataset with Prodigy data</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>recon/dataset.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">from_prodigy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prodigy_datasets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Need to have from_prodigy accept multiple datasets as a list of str so Prodigy</span>
<span class="sd">    can stay separate and new annotation sessions can happen often. Basically prodigy db-merge</span>

<span class="sd">    Need to save to only 1 prodigy dataset though for consistency</span>

<span class="sd">    Args:</span>
<span class="sd">        prodigy_datasets (List[str]): List of prodigy datasets to load from</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dataset: Initialized dataset with Prodigy data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">recon.prodigy.utils</span> <span class="kn">import</span> <span class="n">from_prodigy</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading data from prodigy datasets: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prodigy_datasets</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">prodigy_dataset</span> <span class="ow">in</span> <span class="n">prodigy_datasets</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">+=</span> <span class="n">from_prodigy</span><span class="p">(</span><span class="n">prodigy_dataset</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="recon.dataset.Dataset.from_spacy" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">from_spacy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>


<a href="#recon.dataset.Dataset.from_spacy" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Load Dataset from a file in the .spacy format</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>Path</code></td>
        <td><p>path to load from</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dataset</code></td>
      <td><p>Initialized dataset with Prodigy data</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>recon/dataset.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">from_spacy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Load Dataset from a file in the .spacy format</span>

<span class="sd">    Args:</span>
<span class="sd">        path (Path): path to load from</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dataset: Initialized dataset with Prodigy data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">from_spacy</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="recon.dataset.Dataset.pipe_" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">pipe_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operations</span><span class="p">)</span></code>


<a href="#recon.dataset.Dataset.pipe_" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Run a sequence of operations on dataset data.
Internally calls Dataset.apply_ and will resolve named
operations in registry.operations</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>operations</code></td>
        <td><code>List[Union[str, OperationState]]</code></td>
        <td><p>List of operations</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>recon/dataset.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">pipe_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">OperationState</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Run a sequence of operations on dataset data.</span>
<span class="sd">    Internally calls Dataset.apply_ and will resolve named</span>
<span class="sd">    operations in registry.operations</span>

<span class="sd">    Args:</span>
<span class="sd">        operations (List[Union[str, OperationState]]): List of operations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="n">Printer</span><span class="p">(</span><span class="n">no_print</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verbose</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Applying pipeline of operations inplace to the dataset: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">operations</span><span class="p">:</span>
        <span class="n">op_name</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">OperationState</span><span class="p">)</span> <span class="k">else</span> <span class="n">op</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;|_ </span><span class="si">{</span><span class="n">op_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">operations</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">op_name</span> <span class="o">=</span> <span class="n">op</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">initial_state</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">OperationState</span><span class="p">):</span>
            <span class="n">op_name</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">args</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">kwargs</span>
            <span class="n">initial_state</span> <span class="o">=</span> <span class="n">op</span>

        <span class="n">operation</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">op_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apply_</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">initial_state</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h3 id="recon.dataset.Dataset.rollback" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">rollback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>


<a href="#recon.dataset.Dataset.rollback" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Rollback the last n operations on a dataset.</p>
<p>e.g.
    ```
    ds = Dataset("name", data)</p>
<div class="codehilite"><pre><span></span><code>initial_ds_hash = hash(ds)

ds.apply_(&quot;some_operation&quot;)
ds.rollback()

hash(ds) == initial_ds_hash
&gt;&gt;&gt; True # This should be True
</code></pre></div>

<p>Args:
    n (int): Number of operations to rollback</p>

        <details class="quote">
          <summary>Source code in <code>recon/dataset.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">rollback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Rollback the last n operations on a dataset.</span>

<span class="sd">    e.g.</span>
<span class="sd">        ```</span>
<span class="sd">        ds = Dataset(&quot;name&quot;, data)</span>

<span class="sd">        initial_ds_hash = hash(ds)</span>

<span class="sd">        ds.apply_(&quot;some_operation&quot;)</span>
<span class="sd">        ds.rollback()</span>

<span class="sd">        hash(ds) == initial_ds_hash</span>
<span class="sd">        &gt;&gt;&gt; True # This should be True</span>

<span class="sd">    Args:</span>
<span class="sd">        n (int): Number of operations to rollback</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot rollback dataset: n must be 1 or higher.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operations</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot rollback dataset: n is larger than the total number of dataset operations.&quot;</span><span class="p">)</span>

    <span class="n">store</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">example_store</span>

    <span class="n">examples_to_remove</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">examples_to_add</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">operations</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:]:</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">op</span><span class="o">.</span><span class="n">transformations</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">TransformationType</span><span class="o">.</span><span class="n">EXAMPLE_ADDED</span><span class="p">:</span>
                <span class="n">examples_to_remove</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">example</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">TransformationType</span><span class="o">.</span><span class="n">EXAMPLE_CHANGED</span><span class="p">:</span>
                <span class="n">examples_to_remove</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">example</span><span class="p">)</span>
                <span class="n">examples_to_add</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">store</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">prev_example</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
            <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">TransformationType</span><span class="o">.</span><span class="n">EXAMPLE_REMOVED</span><span class="p">:</span>
                <span class="n">examples_to_add</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">store</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">prev_example</span><span class="p">])</span>  <span class="c1"># type: ignore</span>

    <span class="n">old_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="nb">hash</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">examples_to_remove</span><span class="p">]</span>
    <span class="n">old_data</span> <span class="o">+=</span> <span class="n">examples_to_add</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">old_data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operations</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">examples_to_remove</span><span class="p">:</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_example_store</span><span class="o">.</span><span class="n">_map</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="recon.dataset.Dataset.search" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_query</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#recon.dataset.Dataset.search" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Naive search method to quickly identify examples matching the provided substring</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>search_query</code></td>
        <td><code>str</code></td>
        <td><p>Substring to search each example for</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>case_sensitive</code></td>
        <td><code>bool</code></td>
        <td><p>Consider case of search query and example text</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[Example]</code></td>
      <td><p>Matched examples</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>recon/dataset.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Example</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Naive search method to quickly identify examples matching the provided substring</span>

<span class="sd">    Args:</span>
<span class="sd">        search_query (str): Substring to search each example for</span>
<span class="sd">        case_sensitive (bool, optional): Consider case of search query and example text</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Example]: Matched examples</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">search_query</span> <span class="o">=</span> <span class="n">search_query</span> <span class="k">if</span> <span class="n">case_sensitive</span> <span class="k">else</span> <span class="n">search_query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">out_examples</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="n">example_text</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">case_sensitive</span> <span class="k">else</span> <span class="n">example</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">search_query</span> <span class="ow">in</span> <span class="n">example_text</span><span class="p">:</span>
            <span class="n">out_examples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">out_examples</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="recon.dataset.Dataset.set_example_store" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">set_example_store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">example_store</span><span class="p">)</span></code>


<a href="#recon.dataset.Dataset.set_example_store" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Overwrite the the internal ExampleStore. You probably don't want to call this.
Used by the Corpus to ensure the ExampleStore of each dataset is complete.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>example_store</code></td>
        <td><code>ExampleStore</code></td>
        <td><p>ExampleStore to overwrite with</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>recon/dataset.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">set_example_store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">example_store</span><span class="p">:</span> <span class="n">ExampleStore</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Overwrite the the internal ExampleStore. You probably don&#39;t want to call this.</span>
<span class="sd">    Used by the Corpus to ensure the ExampleStore of each dataset is complete.</span>

<span class="sd">    Args:</span>
<span class="sd">        example_store (ExampleStore): ExampleStore to overwrite with</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_example_store</span> <span class="o">=</span> <span class="n">example_store</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="recon.dataset.Dataset.to_disk" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">to_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_examples</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#recon.dataset.Dataset.to_disk" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Save Corpus to Disk</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>output_dir</code></td>
        <td><code>Path</code></td>
        <td><p>Output file path to save data to</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>overwrite</code></td>
        <td><code>bool</code></td>
        <td><p>Force save to directory. Create parent directories
or overwrite existing data.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>save_examples</code></td>
        <td><code>bool</code></td>
        <td><p>Save the example store along with the state.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>recon/dataset.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">to_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">save_examples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Save Corpus to Disk</span>

<span class="sd">    Args:</span>
<span class="sd">        output_dir (Path): Output file path to save data to</span>
<span class="sd">        overwrite (bool): Force save to directory. Create parent directories</span>
<span class="sd">            or overwrite existing data.</span>
<span class="sd">        save_examples (bool): Save the example store along with the state.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">ensure_path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
    <span class="n">state_dir</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;.recon&quot;</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">output_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Output directory is not empty. Set overwrite=True in Dataset.to_disk to clear the directory before saving.&quot;</span>
        <span class="p">)</span>

    <span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">state_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">state_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">DatasetOperationsState</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commit_hash</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">operations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">operations</span>
    <span class="p">)</span>
    <span class="n">srsly</span><span class="o">.</span><span class="n">write_json</span><span class="p">(</span><span class="n">state_dir</span> <span class="o">/</span> <span class="s2">&quot;state.json&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">save_examples</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">example_store</span><span class="o">.</span><span class="n">to_disk</span><span class="p">(</span><span class="n">state_dir</span> <span class="o">/</span> <span class="s2">&quot;example_store.jsonl&quot;</span><span class="p">)</span>

    <span class="n">srsly</span><span class="o">.</span><span class="n">write_jsonl</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.jsonl&quot;</span><span class="p">),</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">])</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="recon.dataset.Dataset.to_prodigy" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">to_prodigy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prodigy_dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#recon.dataset.Dataset.to_prodigy" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Save examples to prodigy dataset</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>prodigy_dataset</code></td>
        <td><code>str</code></td>
        <td><p>Prodigy dataset name to save to.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>overwrite</code></td>
        <td><code>bool</code></td>
        <td><p>Overwrite dataset name if it exists.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>Prodigy dataset name</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>recon/dataset.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">to_prodigy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prodigy_dataset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Save examples to prodigy dataset</span>

<span class="sd">    Args:</span>
<span class="sd">        prodigy_dataset (str, optional): Prodigy dataset name to save to.</span>
<span class="sd">        overwrite (bool, optional): Overwrite dataset name if it exists.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Prodigy dataset name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">recon.prodigy.utils</span> <span class="kn">import</span> <span class="n">to_prodigy</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">prodigy_dataset</span><span class="p">:</span>
        <span class="n">prodigy_dataset</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">commit_hash</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving dataset to prodigy dataset: </span><span class="si">{</span><span class="n">prodigy_dataset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">to_prodigy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">prodigy_dataset</span><span class="p">,</span> <span class="n">overwrite_dataset</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prodigy_dataset</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="recon.dataset.Dataset.to_spacy" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">to_spacy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span></code>


<a href="#recon.dataset.Dataset.to_spacy" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Save data to .spacy file</p>
<p>Saves file as {output_dir}/{self.name}.spacy</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>output_dir</code></td>
        <td><code>Path</code></td>
        <td><p>Output file path to save data to</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>recon/dataset.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">to_spacy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Save data to .spacy file</span>

<span class="sd">    Saves file as {output_dir}/{self.name}.spacy</span>

<span class="sd">    Args:</span>
<span class="sd">        output_dir (Path): Output file path to save data to</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">ensure_path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
    <span class="n">to_spacy</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.spacy&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../corrections/" title="Corrections" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Corrections
              </div>
            </div>
          </a>
        
        
          <a href="../hashing/" title="Hashing" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Hashing
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/kabirkhan/recon" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/kabir_khan14" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.2d1db4bd.min.js"></script>
      <script src="../../assets/javascripts/bundle.6627ddf3.min.js"></script><script id="__lang" type="application/json">{"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../../js/termynal.js"></script>
      
        <script src="https://unpkg.com/mermaid@8.4.6/dist/mermaid.min.js"></script>
      
        <script src="../../js/custom.js"></script>
      
    
  </body>
</html>